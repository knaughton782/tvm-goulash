<HTML>
<meta name="viewport" content="width=device-width, initial-scale=1">

<HEAD>
    <script>
        function cal_rate() {
            n = parseFloat(document.forms[0].number.value);
            pmt = parseFloat(document.forms[0].pmt.value);
            pv = parseFloat(document.forms[0].pv.value);
            fv = parseFloat(document.forms[0].fv.value);
            ioy = parseInt(document.forms[0].ioy.value);

            var iteration_max = 1000;
            var iteration = 0;
            var adjustment = 0.5;
            var solver = 0;
            var sum_all = 0;
            var findTheAnswer = false;
            var inverse = false;

            if (pv > 0 && fv < 0) {
                inverse = true;
            } else if (pv > 0 && fv > 0) {
                alert('Either PV or FV should be negative');
                return;
            } else if (pv < 0 && fv < 0) {
                alert('Either PV or FV should be positive');
                return;
            }

            while (iteration < iteration_max) {
                sum_all = 0;
                rate = solver + 1;

                for (i = 1; i <= n; i++) {
                    sum_all = sum_all + pmt / Math.pow(rate, i);
                }

                sum_all = sum_all + pv;
                sum_all = sum_all + fv / Math.pow(rate, n);

                //console.log(sum_all);

                if (Math.abs(sum_all) < 0.000001) {
                    //I got it!
                    findTheAnswer = true;
                    break;
                } else if (sum_all > 0) {
                    //discountmore.
                    if (inverse == false) solver = solver + adjustment;
                    else solver = solver - adjustment;
                    //To-do: I need to take into account reverse case.

                } else {
                    //subtract discount.
                    if (inverse == false) solver = solver - adjustment;
                    else solver = solver + adjustment;
                }
                adjustment = adjustment / 1.5;
                iteration = iteration + 1;
            }
            if (findTheAnswer == true) {

                rate = rate - 1;
                rate = rate * 100000;
                rate = Math.round(rate);
                rate = rate / 100000;
                rate = rate * ioy;
                document.forms[0].rate.value = rate;
            } else {
                alert('Unable to find YTM!');
            }

        }
        function cal_fv() {
            n = parseFloat(document.forms[0].number.value);
            pmt = parseFloat(document.forms[0].pmt.value);
            pv = parseFloat(document.forms[0].pv.value);
            rate = parseFloat(document.forms[0].rate.value);
            ioy = parseInt(document.forms[0].ioy.value);

            rate = rate / ioy;

            rate = rate + 1;
            sum_all = 0;
            sum_all = sum_all + pv * Math.pow(rate, n);

            for (i = 1; i <= n; i++) {
                sum_all = sum_all + pmt * Math.pow(rate, i);
            }

            document.forms[0].fv.value = sum_all;

        }
        function cal_pmt() {
            //Annuity

            n = parseFloat(document.forms[0].number.value);
            pv = parseFloat(document.forms[0].pv.value);
            rate = parseFloat(document.forms[0].rate.value);
            fv = parseFloat(document.forms[0].fv.value);
            ioy = parseInt(document.forms[0].ioy.value);

            rate = rate / ioy;

            rate = rate + 1;

            total = pv + fv;

            total = total / ((1 - Math.pow(rate, -n)) / (rate - 1))
            direction = pv / pv;
            total = - direction * total;

            document.forms[0].pmt.value = total;
        }
        function cal_pv() {
            n = parseFloat(document.forms[0].number.value);
            pv = parseFloat(document.forms[0].pv.value);
            rate = parseFloat(document.forms[0].rate.value);
            fv = parseFloat(document.forms[0].fv.value);
            pmt = parseFloat(document.forms[0].pmt.value);
            ioy = parseInt(document.forms[0].ioy.value);

            rate = rate / ioy;

            sum_all = 0;
            rate = rate + 1;

            for (i = 1; i <= n; i++) {
                sum_all = sum_all + (pmt / Math.pow(rate, i));
            }
            sum_all = sum_all + (fv / Math.pow(rate, n));
            sum_all = -sum_all;

            document.forms[0].pv.value = sum_all;
        }

    </script>
    <STYLE>
        .inputbox {
            width: 100px;
            border: 1px solid #CCC;
            height: 30px;
            font-size: 12pt;
        }
    </STYLE>

</head>

<BODY>
    <div class="content">
        <div class="container">
            <div class="">
                <form action="" class="indent">

                    <label>PV </label>
                    <input id="pvalue" type="number" placeholder="0"><br>

                    <label>FV </label>
                    <input id="FV" type="number" placeholder="0"><br>

                    <label>&nbsp;&nbsp;&nbsp;i </label>
                    <input id="int" type="number" placeholder="00"><br>

                    <label>&nbsp;&nbsp;n </label>
                    <input id="yrs" type="number" placeholder="0"><br>

                </form>
                <button onclick="calc_FV()" type="button" class="btn calculate-btn">Calculate</button>
            </div>
            <div class="answer" id="answer"></div>
        </div>
    </div>


    <form name="calc">
        <Table border="1">
            <TR>
                <td style="padding: 10px">N(Period)</TD>
                <td style="padding: 10px"><input type="text" name="number" value="10" class="inputbox"></TD>
            </TR>
            <TR>
                <td style="padding: 10px">PMT</TD>
                <td style="padding: 10px"><input type="text" name="pmt" value="50" class="inputbox"><Input type="button" value="calculate PMT" onclick="cal_pmt()"></TD>
            </TR>
            <TR>
                <td style="padding: 10px">PV</TD>
                <td style="padding: 10px"><input type="text" name="pv" value="-950" class="inputbox"><Input type="button" value="calculate PV" onclick="cal_pv()"></TD>
            </TR>
            <TR>
                <td style="padding: 10px">FV</TD>
                <td style="padding: 10px"><input type="text" name="fv" value="1000" class="inputbox">
                    <Input type="button" value="calculate FV" onclick="cal_fv()"></TD>
            </TR>
            <TR>
                <td style="padding: 10px">RATE</TD>
                <td style="padding: 10px"><input type="text" name="rate" value="0.05" class="inputbox"><Input type="button" value="calculate YTM" onclick="cal_rate()"></TD>
            </TR>
            <TR>
                <td style="padding: 10px">IoY</TD>
                <td style="padding: 10px"><input type="text" name="ioy" value="2" class="inputbox"></TD>
            </TR>
        </TABLE>
    </form><BR>

</BODY>

</HTML>